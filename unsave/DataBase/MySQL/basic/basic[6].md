# 基础[6]

<a id="0">`目录`</a>

- $\textcolor{#e18a3b}{【一】}$**[表的管理](#1)**
- $\textcolor{#e18a3b}{【二】}$**[数据增删改](#2)**
- $\textcolor{#e18a3b}{【三】}$**[数据类型](#3)**

## 一、表的管理

<a id="1"><!--目录--></a>

- $\textcolor{#2a6e3f}{【1】}$ [基础知识](#1.1)
- $\textcolor{#2a6e3f}{【2】}$ [数据库管理](#1.2)
- $\textcolor{#2a6e3f}{【3】}$ [表管理](#1.3)
- $\textcolor{#2a6e3f}{【4】}$ [其他](#1.4)

### 1、基础知识<a id="1.1">💚</a>

#### 1.1、存储过程

![](https://pic1.imgdb.cn/item/634e92a016f2c2beb1fb2e6f.png)

#### 1.2、标识符规则

- 数据库名、表名不得超过30个字符，变量名限制为29个 。
- 必须只能包含 A–Z, a–z, 0–9, _共63个字符 。
- 数据库名、表名、字段名等对象名中间**不要包含空格。**
- 同一个MySQL软件中，数据库不能同名；同一个库中，表不能重名；同一个表中，字段不能重名。
-  必须保证你的字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，请在SQL语句中**使用`（着重号）引起来**。
- 保持字段名和类型的一致性：在命名字段并为其指定数据类型的时候一定要保证一致性，假如数据 类型在一个表里是整数，那在另一个表里可就别变成字符型了。

### 2、数据库管理<a id="1.2">💚</a>

**详细请看MySQL语句** :watermelon:

**[MySQL命令语句](../order.md#2)**

### 3、表管理<a id="1.3">💚</a>

**详细请看MySQL语句** :watermelon:

**[MySQL命令语句](../order.md#3)**

### 4、其他<a id="1.4">💚</a>

**ROOLBACK**:数据回滚

**COMMIT**：数据提交

> `TRUNCATE`语句不能回滚，而使用 `DELETE` 语句删除数据，加上条件修改，可以回滚
>
> 条件修改语句
>
> ```sql
> SET autocommit = FALSE;
> ```

`阿里开发规范`

【参考】：TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但 TRUNCATE 无 事务且不触发 TRIGGER，有可能造成事故，故不建议在开发代码中使用此语句。 

【说明】：TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。

---

[<!--返回目录-->](#1)

## 二、数据增删改

<a id="2"><!--目录--></a>

- $\textcolor{#2a6e3f}{【1】}$ [插入数据](#2.1)
- $\textcolor{#2a6e3f}{【2】}$ [更新数据](#2.2)
- $\textcolor{#2a6e3f}{【3】}$ [删除数据](#2.3)
- $\textcolor{#2a6e3f}{【4】}$ [其他](#2.4)

### 1、插入数据<a id="2.1">💛</a>

#### 1.1、直接插入

##### 1、默认顺序插入

```sql
INSERT INTO [表名] VALUES (value1,value2,....);
```

> `注意`
>
> 其中==VALUSE==的顺序不可更改，先后顺序不可错误

<!--举例-->

```sql
INSERT INTO data_values
VALUES (1, 'maXin', '2022-10-24',4500)
```

##### 2、指定字段插入

```sql
INSERT INTO [表名](column1 [, column2, …, columnn]) 
VALUES (value1 [,value2, …, valuen]);
```

> **指明添加字段，不考虑顺序**
>
> 如果未指明添加，**则为NULL，或者为约束值。**

<!--举例-->

```sql
INSERT INTO data_values(id, name, hire_date)
VALUES (1, 'maXin', '2022-10-24')
```

##### 3、同时插入多条数据

```sql
INSERT INTO table_name 
VALUES (value1 [,value2, …, valuen]), 
(value1 [,value2, …, valuen]),
…… 
(value1 [,value2, …, valuen]);
```

<!--举例-->

```sql
INSERT INTO data_values(id, name, hire_date, salary)
VALUES (1, 'maXin', '2022-10-24', 4500),
       (1, 'wangXin', '2022-10-19', 5500),
       (1, 'zhangXin', '2022-10-20', 6500),
       (1, 'haiXin', '2022-10-21', 7500),
       (1, 'xieXin', '2022-10-22', 6800),
       (1, 'yangXin', '2022-10-23', 7200);
```

#### 1.2、查询结果插入

```sql
INSERT INTO [目标表名] 
(tar_column1 [, tar_column2, …, tar_columnn]) 
SELECT 
(src_column1 [, src_column2, …, src_columnn]) 
FROM 源表名 
[WHERE condition]
```

> `注意`
>
> - 在 INSERT 语句中加入子查询。 
> - 不必书写 VALUES 子句。 
> - 子查询中的值列表应与 INSERT 子句中的列名对应。
> - 注意两个表字段的数据类型

<!--举例-->

```sql
INSERT INTO data_values(id, name, salary, hire_date)
SELECT employee_id,last_name,salary,hire_date
    FROM employees
WHERE department_id IN (70,60)
```

### 2、更新数据<a id="2.2">💛</a>

```sql
UPDATE table_name 
SET column1=value1, column2=value2, … , column=valuen
<WHERE condition>
```

<!--举例-->

```sql
UPDATE data_values
SET hire_date = NOW(),salalry =5400
WHERE id = 103
```

`注意`

- 可以一次更新多条数据。
-  如果需要回滚数据，需要保证在DML前，进行设置：==SET AUTOCOMMIT = FALSE;==
- **如果省略 WHERE 子句，则表中的所有数据都将被更新。**
- 修改数据时可能由于约束影响导致不成功

### 3、删除数据<a id="2.3">💛</a>

```sql
DELETE FROM [table_name] <WHERE [condition]>;
```

<!--举例-->

```sql
DELETE
FROM data_values
WHERE id = 104;
```

`注意`

- **如果省略 WHERE 子句，则表中的全部数据将被删除**
- 删除数据时可能由于约束影响导致不成功
-  如果需要回滚数据，需要保证在DML前，进行设置：==SET AUTOCOMMIT = FALSE;==

### 4、其他<a id="2.4">💛</a>

#### 4.1、计算列

> 某一列的值是通过别的列计算得来的。例如，a列值为1、b列值为2，c列 不需要手动插入，定义a+b的结果为c的值，那么c就是计算列，是通过别的列计算得来的。

```sql
CREATE TABLE tb1( 
id INT, 
a INT, 
b INT,
c INT GENERATED ALWAYS AS (a + b) VIRTUAL 
);
```

<!--举例-->

```sql
INSERT INTO tb1(a, b)
VALUES (10, 20);


UPDATE tb1
SET a=100
WHERE a=10;
```



---

[<!--返回目录-->](#2)

## 三、数据类型

<a id="3"><!--目录--></a>

- $\textcolor{#2a6e3f}{【1】}$ [数据类型](#3.1)
- $\textcolor{#2a6e3f}{【2】}$ [整数类型](#3.2)
- $\textcolor{#2a6e3f}{【3】}$ [浮点类型](#3.3)
- $\textcolor{#2a6e3f}{【4】}$ [定点数](#3.4)
- $\textcolor{#2a6e3f}{【5】}$ [位类型](#3.5)
- $\textcolor{#2a6e3f}{【6】}$ [日期与时间](#3.6)
- $\textcolor{#2a6e3f}{【7】}$ [文本字符串](#3.7)
- $\textcolor{#2a6e3f}{【8】}$ [枚举型](#3.8)
- $\textcolor{#2a6e3f}{【9】}$ [集合型](#3.9)
- $\textcolor{#2a6e3f}{【10】}$ [二进制字符串](#3.10)
- $\textcolor{#2a6e3f}{【11】}$ [JSON](#3.11)
- $\textcolor{#2a6e3f}{【12】}$ [空间数据](#3.12)
- $\textcolor{#2a6e3f}{【13】}$ [小结](#3.13)

### 1、数据类型<a id="3.1">💙</a>

![](https://pic1.imgdb.cn/item/63568bd716f2c2beb1406309.png)

### 2、整数<a id="3.2">💙</a>

|       类型       | 字节 | 范围                                     | 无符号范围             |
| :--------------: | :--: | ---------------------------------------- | ---------------------- |
|   **TINYINT**    |  1   | -128~127                                 | 0~255                  |
|   **SMALLINT**   |  2   | -32768-32767                             | 0~65535                |
|  **MENIUMENT**   |  3   | -8388608~8388607                         | 0~16777215             |
| **INT(INTEGER)** |  4   | -2147483648~2147483647                   | 0~4294967295           |
|    **BIGINT**    |  8   | -9223372036854775808~9223372036854775807 | 0~18446744073709551615 |

`UNSIGNED` : 无符号类型（非负），所有的整数类型都有一个可选的属性UNSIGNED（无符号属性），无 符号整数类型的最小取值为0。所以，如果需要在MySQL数据库中保存非负整数值时，可以将整数类型设 置为无符号类型。

<!--使用场景-->

`TINYINT` ：一般用于枚举数据，比如系统设定取值范围很小且固定的场景。

 `SMALLINT` ：可以用于较小范围的统计数据，比如统计工厂的固定资产库存数量等。 

`MEDIUMINT` ：用于较大整数的计算，比如车站每日的客流量等。 

`INT、INTEGER` ：取值范围足够大，一般情况下不用考虑超限问题，用得最多。比如商品编号。
`BIGINT` ：只有当你处理特别巨大的整数时才会用到。比如双十一的交易量、大型门户网站点击量、证 券公司衍生产品持仓等。

### 3、浮点<a id="3.3">💙</a>

|    类型    | 字节 |
| :--------: | :--: |
| **FLOAT**  |  4   |
| **DOUBLE** |  8   |

#### 3.1、精度说明

对于浮点类型，在MySQL中单精度值使用 4 个字节，双精度值使用 8 个字节。

- MySQL允许使用 <mark>非标准语法</mark> （其他数据库未必支持，因此如果涉及到数据迁移，则最好不要这么 用）： **FLOAT(M,D) 或 DOUBLE(M,D)** 。这里，**M称为 <mark>精度</mark>** ，<mark>**D称为 标度**</mark> 。**(M,D)中 M=整数位+小数 位，D=小数位。 D<=M<=255，0<=D<=30。** 

  例如，定义为FLOAT(5,2)的一个列可以显示为-999.99-999.99。如果超过这个范围会报错。

-  FLOAT和DOUBLE类型在不指定(M,D)时，默认会按照实际的精度（由实际的硬件和操作系统决定） 来显示。

- 说明：浮点类型，也可以加 UNSIGNED ，但是不会改变数据范围，例如：FLOAT(3,2) UNSIGNED仍然 只能表示0-9.99的范围。

- 不管是否显式设置了精度(M,D)，这里MySQL的处理方案如下： 

  - 如果存储时，整数部分超出了范围，MySQL就会报错，不允许存这样的值 
  - 如果存储时，小数点部分若超出范围，就分以下情况：
    - 若四舍五入后，整数部分没有超出范围，则只警告，但能成功操作并四舍五入删除多余 的小数位后保存。例如在FLOAT(5,2)列内插入999.009，近似结果是999.01。 
    - 若四舍五入后，整数部分超出范围，则MySQL报错，并拒绝处理。如FLOAT(5,2)列内插入 999.995和-999.995都会报错。

- **从MySQL 8.0.17开始，FLOAT(M,D) 和DOUBLE(M,D)用法在官方文档中已经明确不推荐使用**，将来可能被移除。另外，关于浮点型FLOAT和DOUBLE的UNSIGNED也不推荐使用了，将来也可能被移除。

### 4、定点数<a id="3.4">💙</a>

|           类型            | 字节数  |
| :-----------------------: | :-----: |
| DECIMAL(M,D),DEC,NUMBERIC | M+2字节 |

> 使用 DECIMAL(M,D) 的方式表示高精度小数。其中，M被称为精度，D被称为标度。0<=M<=65， 0<=D<=30，D<M。例如，定义DECIMAL（5,2）的类型，表示该列取值范围是-999.99~999.99。

- **DECIMAL(M,D)的最大取值范围与DOUBLE类型一样**，但是有效的数据范围是由M和D决定的。 DECIMAL 的存储空间并不是固定的，由精度值M决定，总共占用的存储空间为M+2个字节。也就是 说，在一些对精度要求不高的场景下，比起占用同样字节长度的定点数，浮点数表达的数值范围可 以更大一些。
-  定点数在MySQL内部是以 `字符串` 的形式进行存储，这就决定了它一定是精准的。 
- 当DECIMAL类型不指定精度和标度时，其默认为DECIMAL(10,0)。当数据的精度超出了定点数类型的 精度范围时，则MySQL同样会进行四舍五入处理。 
- 浮点数 vs 定点数
  - 浮点数相对于定点数的优点是在长度一定的情况下，浮点类型取值范围大，但是不精准，适用 于需要取值范围大，又可以容忍微小误差的科学计算场景（比如计算化学、分子建模、流体动 力学等）
  - 定点数类型取值范围相对小，但是精准，没有误差，适合于对精度要求极高的场景 （比如涉 及金额计算的场景）

### 5、位类型<a id="3.5">💙</a>

| BIT（M） | M    | 1<=M<=64 | (m+7)/8 字节 |
| -------- | ---- | -------- | ------------ |

- BIT类型，如果没有指定(M)，默认是1位。这个1位，表示只能存1位的二进制值。这里(M)是表示二进制的 位数，位数最小值为1，最大值为64。
- 使用SELECT命令查询位字段时，可以用 BIN() 或 HEX() 函数进行读取。

### 6、日期与时间<a id="3.6">💙</a>

- YEAR 类型通常用来表示年
-  DATE 类型通常用来表示年、月、日
-  TIME 类型通常用来表示时、分、秒
-  DATETIME 类型通常用来表示年、月、日、时、分、秒
-  TIMESTAMP 类型通常用来表示带时区的年、月、日、时、分、秒

![](https://pic1.imgdb.cn/item/635a384116f2c2beb1c6d5ec.png)

### 7、字符串<a id="3.7">💙</a>

![](https://pic1.imgdb.cn/item/635a38c716f2c2beb1c8020e.png)

#### 7.1、CHAR

- CHAR(M) 类型一般需要预先定义字符串长度。如果不指定(M)，则表示**长度默认是1个字符**。
-  如果保存时，数据的实际长度比CHAR类型声明的长度小，则会在 右侧填充 空格以达到指定的长 度。当MySQL检索CHAR类型的数据时，CHAR类型的字段会去除尾部的空格。
-  定义CHAR类型字段时，声明的字段长度即为CHAR类型字段所占的存储空间的字节数。

### 8、枚举<a id="3.8">💙</a>

### 9、集合<a id="3.9">💙</a>

### 10、二进制字符串<a id="3.10">💙</a>

### 11、JSON<a id="3.11">💙</a>

### 12、空间数据<a id="3.12">💙</a>

### 13、小结<a id="3.13">💙</a>

---

[<!--返回目录-->](#3)

[<!--返回总目录-->](#0)

**[返回上一页🥣](../../README.md)**